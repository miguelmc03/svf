<odoo>
    <data>
        <template id="3mit_inherit_repair_order" inherit_id="repair.report_repairorder">
            <xpath expr="//div[hasclass('page')]" position="replace">

                <div class="page">
                    <div class="oe_structure"/>

                    <h2>
                        <span t-if="o.state != 'draft'">Orden de reparación #:</span>
                        <span t-if="o.state == 'draft'">Cotización de reparación #:</span>
                        <span t-field="o.name"/>
                    </h2>

                    <div id="informations" class="row mt32 mb32">
                        <div t-if="o.product_id.name" class="col-3 bm-2">
                            <strong>Producto a reparar:</strong>
                            <p t-field="o.product_id.name" class="m-0"/>
                        </div>
                        <div class="col-3 bm-2" groups="stock.group_production_lot">
                            <strong>Lote/Número de Serie:</strong>
                            <t t-if="o.lot_id">
                                <span t-field="o.lot_id.name"/>
                            </t>
                        </div>
                        <div t-if="o.guarantee_limit" class="col-3 bm-2">
                            <strong>Garantía:</strong>
                            <p t-field="o.guarantee_limit" class="m-0"/>
                        </div>
                        <div class="col-3 bm-2">
                            <strong>Fecha de impresión:</strong>
                            <p t-esc="datetime.datetime.now().strftime('%Y-%m-%d')" t-options="{'widget': 'date'}" class="m-0"/>
                        </div>
                    </div>

                    <table class="table table-sm o_main_table">
                        <thead>
                            <tr>
                                <th>Descripción</th>
                                <th class="text-right">Cantidad</th>
                                <th class="text-right">Precio unitario</th>
                                <th class="text-center">Impuesto</th>
                                <th class="text-right">Precio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-if="o.operations">
                                <tr class="bg-200 o_line_section"><td colspan="5"><strong>Partes</strong></td></tr>
                                <tr t-foreach="o.operations" t-as="line">
                                    <td>
                                        <p t-if="line.type == 'add'"><i>(Añadir)</i> <span t-field="line.name" /></p>
                                        <p t-if="line.type == 'remove'">(<i>Eliminar</i>) <span t-field="line.name"/></p>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.product_uom_qty"/>
                                        <span groups="uom.group_uom" t-field="line.product_uom.name"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td class="text-center">
                                        <span t-esc="','.join(map( lambda x: x.name, line.tax_id))"/>
                                    </td>
                                    <td class="text-right o_price_total">
                                        <span t-field="line.price_subtotal" t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="o.fees_lines">
                                <tr class="bg-200 o_line_section"><td colspan="5"><strong>Operaciones</strong></td></tr>
                                <tr t-foreach="o.fees_lines" t-as="fees">
                                    <td>
                                        <span t-field="fees.name"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="fees.product_uom_qty"/>
                                        <span groups="uom.group_uom" t-field="fees.product_uom.name"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="fees.price_unit"/>
                                    </td>
                                    <td class="text-center">
                                        <span t-esc="','.join(map( lambda x: x.name, fees.tax_id))"/>
                                    </td>
                                    <td class="text-right o_price_total">
                                        <span t-field="fees.price_subtotal"
                                              t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>

                    <div id="total" class="row justify-content-end">
                        <div class="col-4">
                            <table class="table table-sm">
                                <tr class="border-black o_subtotal">
                                    <td><strong>Total sin impuestos</strong></td>
                                    <td class="text-right">
                                        <span t-field="o.amount_untaxed"
                                              t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Impuestos</td>
                                    <td class="text-right o_price_total">
                                        <span t-field="o.amount_tax"
                                              t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                                <tr class="border-black o_total">
                                    <td><strong>Total</strong></td>
                                    <td class="text-right o_price_total">
                                        <span t-field="o.amount_total"
                                              t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <p t-field="o.quotation_notes"/>
                    <div class="oe_structure"/>
                </div>

            </xpath>
        </template>
    </data>
</odoo>